{"version":3,"sources":["webpack:///./src/pages/piano/index/comp/comp/xw-switch.vue?668b","webpack:///./src/pages/piano/index/comp/panels/settings.vue","webpack:///./src/pages/piano/index/comp/comp/xw-switch.vue","webpack:///src/pages/piano/index/comp/comp/xw-switch.vue","webpack:///./src/pages/piano/index/comp/comp/xw-switch.vue?afff","webpack:///./src/pages/piano/index/comp/comp/xw-switch.vue?a54d","webpack:///./src/pages/piano/index/comp/panels/settings-midi-peripheral.vue","webpack:///./src/pages/piano/index/comp/controllers/midi-peripheral.js","webpack:///src/pages/piano/index/comp/panels/settings-midi-peripheral.vue","webpack:///./src/pages/piano/index/comp/panels/settings-midi-peripheral.vue?aa4c","webpack:///./src/pages/piano/index/comp/panels/settings-midi-peripheral.vue?8a39","webpack:///src/pages/piano/index/comp/panels/settings.vue","webpack:///./src/pages/piano/index/comp/panels/settings.vue?c6f0","webpack:///./src/pages/piano/index/comp/panels/settings.vue?71d4","webpack:///./src/pages/piano/index/comp/panels/settings.vue?72fe","webpack:///./src/pages/piano/index/comp/panels/settings-midi-peripheral.vue?afb7"],"names":["render","_vm","this","_c","_self","staticClass","_v","model","value","state","hideNavBar","callback","$$v","$set","expression","cacheConf","showKbdNum","attrs","on","$event","scaleCG","_s","scale","directives","name","rawName","barScale","style","width","concat","left","mleft","staticRenderFns","class","trigger","prop","event","props","Boolean","data","methods","$emit","component","support","doConnect","linked","doDisconnect","_e","errMsg","deviceInfo","length","_l","item","key","id","manufacturer","isSupport","runtime","isServer","navigator","requestMIDIAccess","onMIDIMessage","msg","idx","size","keypress","down","up","MidiParser","midiAccess","_classCallCheck","enable","inputs","values","setMidiInputs","_createClass","_this","input","next","done","onmidimessage","midiMessage","push","forEach","midiParser","getMidiParse","connect","Promise","resolve","reject","then","midi","destory","Error","disConnect","components","xwButton","mounted","refreshInfo","catch","e","xwSwitch","settingsMidiPeripheral","computed","$store","watch","$nextTick","resize","v","s","f"],"mappings":"kHAAA,W,6FCAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,aAAa,CAACF,EAAG,MAAM,CAACE,YAAY,WAAW,CAACF,EAAG,MAAM,CAACE,YAAY,QAAQ,CAACF,EAAG,MAAM,CAACE,YAAY,WAAW,CAACF,EAAG,QAAQ,CAACF,EAAIK,GAAG,cAAcH,EAAG,WAAW,CAACI,MAAM,CAACC,MAAOP,EAAIQ,MAAMC,WAAYC,SAAS,SAAUC,GAAMX,EAAIY,KAAKZ,EAAIQ,MAAO,aAAcG,IAAME,WAAW,uBAAuB,GAAGX,EAAG,MAAM,CAACE,YAAY,WAAW,CAACF,EAAG,QAAQ,CAACF,EAAIK,GAAG,cAAcH,EAAG,WAAW,CAACI,MAAM,CAACC,MAAOP,EAAIQ,MAAMM,UAAUC,WAAYL,SAAS,SAAUC,GAAMX,EAAIY,KAAKZ,EAAIQ,MAAMM,UAAW,aAAcH,IAAME,WAAW,iCAAiC,GAAGX,EAAG,MAAM,CAACE,YAAY,WAAW,CAACF,EAAG,QAAQ,CAACF,EAAIK,GAAG,cAAcH,EAAG,YAAY,CAACc,MAAM,CAAC,KAAO,WAAWC,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOlB,EAAImB,SAAS,MAAM,CAACnB,EAAIK,GAAG,QAAQH,EAAG,IAAI,CAACE,YAAY,aAAa,CAACJ,EAAIK,GAAGL,EAAIoB,GAAGpB,EAAIQ,MAAMM,UAAUO,UAAUnB,EAAG,YAAY,CAACc,MAAM,CAAC,KAAO,WAAWC,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOlB,EAAImB,QAAQ,MAAM,CAACnB,EAAIK,GAAG,SAAS,GAAGH,EAAG,MAAM,CAACE,YAAY,WAAW,CAACF,EAAG,QAAQ,CAACF,EAAIK,GAAG,eAAeH,EAAG,6BAA6B,OAAOA,EAAG,MAAM,CAACoB,WAAW,CAAC,CAACC,KAAK,OAAOC,QAAQ,SAASjB,MAAOP,EAAIQ,MAAMM,UAAUW,SAAW,EAAGZ,WAAW,iCAAiCT,YAAY,aAAa,CAACF,EAAG,MAAM,CAACE,YAAY,gBAAgB,CAACF,EAAG,MAAM,CAACE,YAAY,cAAcsB,MAAO,CACx0CC,MAAO,GAAFC,OAAoC,IAA/B5B,EAAIQ,MAAMM,UAAUW,SAAc,KAC5CI,KAAM,GAAFD,QAAM,EAAI5B,EAAIQ,MAAMM,UAAUW,UAAYzB,EAAIQ,MAAMM,UAAUe,KAAO,IAAG,UACvE3B,EAAG,MAAM,CAACE,YAAY,mBAAmBa,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOlB,EAAI8B,OAAM,MAAU,CAAC9B,EAAIK,GAAG,OAAOH,EAAG,MAAM,CAACE,YAAY,mBAAmBa,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOlB,EAAI8B,OAAM,MAAS,CAAC9B,EAAIK,GAAG,YAEnO0B,EAAkB,GCLlBhC,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,YAAY4B,MAAMhC,EAAIO,MAAQ,WAAa,GAAGU,GAAG,CAAC,MAAQjB,EAAIiC,UAAU,CAAC/B,EAAG,MAAM,CAACE,YAAY,WAEpL2B,EAAkB,GCKP,GACfzB,MAAA,CACA4B,KAAA,QACAC,MAAA,UAEAC,MAAA,CACA7B,MAAA8B,SAEAC,KAAA,WACA,UAEAC,QAAA,CACAN,QAAA,WACA,KAAAO,MAAA,eAAAjC,UCpB8Y,I,wBCQ1YkC,EAAY,eACd,EACA,EACA,GACA,EACA,KACA,KACA,MAIa,EAAAA,E,gCCnBX1C,G,UAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,eAAe,CAAEJ,EAAI0C,QAASxC,EAAG,MAAM,CAACE,YAAY,WAAW,CAACF,EAAG,YAAY,CAACe,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOlB,EAAI2C,eAAe,CAAC3C,EAAIK,GAAGL,EAAIoB,GAAGpB,EAAI4C,OAAS,KAAO,WAAY5C,EAAI4C,OAAQ1C,EAAG,YAAY,CAACe,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOlB,EAAI6C,kBAAkB,CAAC7C,EAAIK,GAAG,QAAQL,EAAI8C,KAAO9C,EAAI4C,OAA0F5C,EAAI8C,KAAtF5C,EAAG,OAAO,CAACE,YAAY,QAAQ,CAACJ,EAAIK,GAAG,2CAAqDL,EAAI+C,OAAQ7C,EAAG,OAAO,CAACE,YAAY,cAAc,CAACJ,EAAIK,GAAGL,EAAIoB,GAAGpB,EAAI+C,WAAW/C,EAAI8C,KAAM9C,EAAIgD,WAAWC,QAAU,EAAG/C,EAAG,MAAM,CAACE,YAAY,UAAUJ,EAAIkD,GAAIlD,EAAIgD,YAAY,SAASG,GAAM,OAAOjD,EAAG,MAAM,CAACkD,IAAID,EAAKE,GAAGjD,YAAY,eAAe,CAACJ,EAAIK,GAAG,SAASL,EAAIoB,GAAG+B,EAAKG,cAAc,IAAItD,EAAIoB,GAAG+B,EAAK5B,MAAM,UAAS,GAAGvB,EAAI8C,KAA+B,GAAzB9C,EAAIgD,WAAWC,QAAejD,EAAI4C,OAAQ1C,EAAG,MAAM,CAACE,YAAY,UAAU,CAACJ,EAAIK,GAAG,YAAYL,EAAI8C,MAAM,GAAG5C,EAAG,MAAM,CAACE,YAAY,eAAe,CAACJ,EAAIK,GAAG,2EAEv8B0B,EAAkB,G,0HCOf,SAASwB,IACd,OAAIC,OAAQC,YAGRC,UAAUC,kBAMhB,SAASC,EAAcC,GAErB,GAAoB,MAAhBA,EAAIvB,KAAK,GAAY,CACvB,IAAMwB,EAAMD,EAAIvB,KAAK,GACfyB,EAAOF,EAAIvB,KAAK,GAClByB,EAAO,EACTC,OAASC,KAAK,CAACH,EAAM,KAAK,EAAO,GAEjCE,OAASE,GAAG,CAACJ,EAAM,IAAK,IAG7B,IAEKK,EAAU,WACd,SAAAA,EAAYC,GAAYC,eAAA,KAAAF,GACtBlE,KAAKmE,WAAaA,EAClBnE,KAAKqE,QAAS,EACd,IAAQC,EAAWH,EAAXG,OACFC,EAASD,EAAOC,SACtBvE,KAAKsE,OAAS,GACdtE,KAAKwE,cAAcD,GACpB,OAAAE,eAAAP,EAAA,EAAAf,IAAA,gBAAA7C,MAED,SAAcgE,GAEZ,IAFoB,IAAAI,EAAA,KAEXC,EAAQL,EAAOM,OAAQD,IAAUA,EAAME,KAAMF,EAAQL,EAAOM,OACnED,EAAMrE,MAAMwE,cAAgB,SAAClB,GAC3Bc,EAAKK,YAAYnB,IAEnB5D,KAAKsE,OAAOU,KAAKL,EAAMrE,SAE1B,CAAA6C,IAAA,cAAA7C,MAED,SAAYsD,GACN5D,KAAKqE,QACPV,EAAcC,KAEjB,CAAAT,IAAA,UAAA7C,MAED,WACEN,KAAKqE,QAAS,EACdrE,KAAKsE,OAAOW,SAAQ,SAAC/B,GACnBA,EAAK4B,cAAgB,YA7BX,GAkCZI,EAAa,KAEV,SAASC,IACd,OAAOD,EAMF,SAASE,IACd,OAAO,IAAIC,SAAQ,SAACC,EAASC,GAC3B9B,UAAUC,oBAAoB8B,MAC5B,SAACC,GACKP,GACFA,EAAWQ,UAEbR,EAAa,IAAIhB,EAAWuB,GAC5BH,OAEF,WAEEC,EAAO,IAAII,MAAM,0CASlB,SAASC,IACVV,GACFA,EAAWQ,UAEbR,EAAa,KCxEA,OACfW,WAAA,CACAC,iBAEAzD,KAAA,WACA,OACAI,SAAA,EACAE,QAAA,EACAI,WAAA,GACAD,OAAA,KAGAiD,QAAA,WACA,KAAAtD,QAAAa,IACA,KAAA0C,eAEA1D,QAAA,CACAI,UAAA,eAAAgC,EAAA,KACAU,IACAI,MAAA,WACAd,EAAAsB,iBAEAC,OAAA,SAAAC,GACAxB,EAAA5B,OAAA,GAAAnB,OAAAuE,OAGAtD,aAAA,WACAgD,IACA,KAAAI,eAEAA,YAAA,WACA,IAAAd,EAAAC,IACA,GAAAD,EAAA,CACA,KAAAvC,QAAA,EACA,IAAAI,EAAA,GACAmC,EAAAZ,OAAAW,SAAA,SAAA/B,GACAH,EAAAiC,KAAA,CACA5B,GAAAF,EAAAE,GACA9B,KAAA4B,EAAA5B,KACA+B,aAAAH,EAAAG,kBAGA,KAAAN,kBAEA,KAAAJ,QAAA,EACA,KAAAI,WAAA,MCzE6Z,ICQzZ,G,UAAY,eACd,EACA,EACA,GACA,EACA,KACA,KACA,OAIa,I,QC2BA,GACf8C,WAAA,CACAM,WACAL,gBACAM,0BAEA/D,KAAA,WACA,UAEAgE,SAAA,CACA9F,MAAA,WACA,YAAA+F,OAAA/F,QAGAgG,MAAA,CACA,8BACA,KAAAC,UAAAC,SAEA,2CAIAV,QAAA,aACAzD,QAAA,CACApB,QAAA,SAAAwF,GACA,IAAAC,EAAA,KAAApG,MAAAM,UAAAO,MACAuF,GAAAD,EACAC,EAAA,EACAA,EAAA,EACAA,EAAA,KACAA,EAAA,IAEA,KAAApG,MAAAM,UAAAO,MAAAuF,EACA,KAAAH,UAAAC,SAEA5E,MAAA,SAAA6E,GACA,IAAAE,EAAA,KAAArG,MAAAM,UAAAe,KACA8E,EACAE,GAAA,GAEAA,GAAA,GAEAA,EAAA,EACAA,EAAA,EACAA,EAAA,IACAA,EAAA,GAEA,KAAArG,MAAAM,UAAAe,KAAAgF,EACAH,oBC9F6Y,ICQzY,G,UAAY,eACd,EACA3G,EACAgC,GACA,EACA,KACA,KACA,OAIa,e,kECnBf,W,kCCAA","file":"js/piano/settings.3949d1ad.js","sourcesContent":["export * from \"-!../../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--12-oneOf-1-0!../../../../../../node_modules/css-loader/dist/cjs.js??ref--12-oneOf-1-1!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/src/index.js??ref--12-oneOf-1-2!../../../../../../node_modules/stylus-loader/index.js??ref--12-oneOf-1-3!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./xw-switch.vue?vue&type=style&index=0&id=fb9b9984&prod&lang=stylus\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"piano-sts\"},[_c('div',{staticClass:\"form-ct\"},[_c('div',{staticClass:\"form\"},[_c('div',{staticClass:\"sts-row\"},[_c('label',[_vm._v(\"隐藏顶部导航栏：\")]),_c('xwSwitch',{model:{value:(_vm.state.hideNavBar),callback:function ($$v) {_vm.$set(_vm.state, \"hideNavBar\", $$v)},expression:\"state.hideNavBar\"}})],1),_c('div',{staticClass:\"sts-row\"},[_c('label',[_vm._v(\"显示键盘上数字：\")]),_c('xwSwitch',{model:{value:(_vm.state.cacheConf.showKbdNum),callback:function ($$v) {_vm.$set(_vm.state.cacheConf, \"showKbdNum\", $$v)},expression:\"state.cacheConf.showKbdNum\"}})],1),_c('div',{staticClass:\"sts-row\"},[_c('label',[_vm._v(\"放大和缩小键盘：\")]),_c('xw-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){return _vm.scaleCG(-1)}}},[_vm._v(\"缩小\")]),_c('b',{staticClass:\"scaletext\"},[_vm._v(_vm._s(_vm.state.cacheConf.scale))]),_c('xw-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){return _vm.scaleCG(1)}}},[_vm._v(\"放大\")])],1),_c('div',{staticClass:\"sts-row\"},[_c('label',[_vm._v(\"外接MIDI键盘：\")]),_c('settings-midi-peripheral')],1)])]),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.state.cacheConf.barScale < 1),expression:\"state.cacheConf.barScale < 1\"}],staticClass:\"btm-fixed\"},[_c('div',{staticClass:\"visible-line\"},[_c('div',{staticClass:\"visible-bar\",style:({\n          width: `${_vm.state.cacheConf.barScale * 100}%`,\n          left: `${(1 - _vm.state.cacheConf.barScale) * _vm.state.cacheConf.left * 100}%`\n        })})]),_c('div',{staticClass:\"xw-btn f-btn lef\",on:{\"click\":function($event){return _vm.mleft(false)}}},[_vm._v(\"左\")]),_c('div',{staticClass:\"xw-btn f-btn rit\",on:{\"click\":function($event){return _vm.mleft(true)}}},[_vm._v(\"右\")])])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"xw-switch\",class:_vm.value ? 'on-state' : '',on:{\"click\":_vm.trigger}},[_c('div',{staticClass:\"bar\"})])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"xw-switch\" :class=\"value ? 'on-state' : ''\" @click=\"trigger\">\r\n    <div class=\"bar\" />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  model: {\r\n    prop: 'value',\r\n    event: 'change',\r\n  },\r\n  props: {\r\n    value: Boolean,\r\n  },\r\n  data() {\r\n    return {};\r\n  },\r\n  methods: {\r\n    trigger() {\r\n      this.$emit('change', !this.value);\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"stylus\">\r\n$size = 14px;\r\n.xw-switch{\r\n    display inline-block;\r\n    vertical-align middle;\r\n    cursor pointer;\r\n    padding 2px 2px;\r\n    margin 0 2px;\r\n    width $size * 2.3;\r\n    height $size;\r\n    background #999;\r\n    border-radius $size;\r\n    border 2px solid #fff;\r\n    transition background 0.3s;\r\n    box-shadow 0 0 5px #0003;\r\n    white-space nowrap;\r\n    >.bar {\r\n        vertical-align top;\r\n        display inline-block;\r\n        width $size;\r\n        height $size;\r\n        margin 0;\r\n        border-radius $size;\r\n        background #fff;\r\n        transition margin 0.3s;\r\n    }\r\n    &.on-state{\r\n        background #0166bdd9;\r\n        >.bar{\r\n            margin 0 0 0 $size * 1.3;\r\n        }\r\n    }\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../../node_modules/babel-loader/lib/index.js!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./xw-switch.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../../node_modules/babel-loader/lib/index.js!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./xw-switch.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./xw-switch.vue?vue&type=template&id=fb9b9984\"\nimport script from \"./xw-switch.vue?vue&type=script&lang=js\"\nexport * from \"./xw-switch.vue?vue&type=script&lang=js\"\nimport style0 from \"./xw-switch.vue?vue&type=style&index=0&id=fb9b9984&prod&lang=stylus\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"midi-access\"},[(_vm.support)?_c('div',{staticClass:\"support\"},[_c('xw-button',{on:{\"click\":function($event){return _vm.doConnect()}}},[_vm._v(_vm._s(_vm.linked ? \"刷新\" : \"立即连接\"))]),(_vm.linked)?_c('xw-button',{on:{\"click\":function($event){return _vm.doDisconnect()}}},[_vm._v(\"断开\")]):_vm._e(),(!_vm.linked)?_c('span',{staticClass:\"tips\"},[_vm._v(\"可将midi键盘或者电钢琴通过USB连接到您的电脑或手机后点击左侧连接按钮\")]):_vm._e(),(_vm.errMsg)?_c('span',{staticClass:\"tips error\"},[_vm._v(_vm._s(_vm.errMsg))]):_vm._e(),(_vm.deviceInfo.length >= 0)?_c('div',{staticClass:\"d-info\"},_vm._l((_vm.deviceInfo),function(item){return _c('div',{key:item.id,staticClass:\"d-info-item\"},[_vm._v(\" 已连接： \"+_vm._s(item.manufacturer)+\" \"+_vm._s(item.name)+\" \")])}),0):_vm._e(),(_vm.deviceInfo.length == 0 && _vm.linked)?_c('div',{staticClass:\"d-info\"},[_vm._v(\"未检测到设备\")]):_vm._e()],1):_c('div',{staticClass:\"not-support\"},[_vm._v(\" 检测到您的浏览器不支持该功能。此功能可在电脑上的Chorme浏览器，大于5.0版本的安卓手机上运行。苹果移动设备上兼容性未知。 \")])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","/**\r\n * midi 外设\r\n */\r\nimport { keypress } from '../piano-control';\r\nimport runtime from '../../../../../lib/runtime';\r\n\r\n/**\r\n * 判断是否支持\r\n */\r\nexport function isSupport() {\r\n  if (runtime.isServer) {\r\n    return false;\r\n  }\r\n  if (navigator.requestMIDIAccess) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction onMIDIMessage(msg) {\r\n  // console.log(msg.data);\r\n  if (msg.data[0] === 144) {\r\n    const idx = msg.data[1];\r\n    const size = msg.data[2];\r\n    if (size > 0) {\r\n      keypress.down([idx - 20], false, 3);\r\n    } else {\r\n      keypress.up([idx - 20], 3);\r\n    }\r\n  }\r\n}\r\n\r\nclass MidiParser {\r\n  constructor(midiAccess) {\r\n    this.midiAccess = midiAccess;\r\n    this.enable = true;\r\n    const { inputs } = midiAccess;\r\n    const values = inputs.values();\r\n    this.inputs = [];\r\n    this.setMidiInputs(values);\r\n  }\r\n\r\n  setMidiInputs(inputs) {\r\n    // each time there is a midi message call the onMIDIMessage function\r\n    for (let input = inputs.next(); input && !input.done; input = inputs.next()) {\r\n      input.value.onmidimessage = (msg) => {\r\n        this.midiMessage(msg);\r\n      };\r\n      this.inputs.push(input.value);\r\n    }\r\n  }\r\n\r\n  midiMessage(msg) {\r\n    if (this.enable) {\r\n      onMIDIMessage(msg);\r\n    }\r\n  }\r\n\r\n  destory() {\r\n    this.enable = false;\r\n    this.inputs.forEach((item) => {\r\n      item.onmidimessage = null;\r\n    });\r\n  }\r\n}\r\n\r\nlet midiParser = null;\r\n\r\nexport function getMidiParse() {\r\n  return midiParser;\r\n}\r\n\r\n/**\r\n * 连接\r\n */\r\nexport function connect() {\r\n  return new Promise((resolve, reject) => {\r\n    navigator.requestMIDIAccess().then(\r\n      (midi) => {\r\n        if (midiParser) {\r\n          midiParser.destory();\r\n        }\r\n        midiParser = new MidiParser(midi);\r\n        resolve();\r\n      },\r\n      () => {\r\n        // console.error('No access to your midi devices.', arg);\r\n        reject(new Error('No access to your midi devices.'));\r\n      },\r\n    );\r\n  });\r\n}\r\n\r\n/**\r\n * 断开连接\r\n */\r\nexport function disConnect() {\r\n  if (midiParser) {\r\n    midiParser.destory();\r\n  }\r\n  midiParser = null;\r\n}\r\n","<template>\r\n  <div class=\"midi-access\">\r\n    <div v-if=\"support\" class=\"support\">\r\n      <xw-button @click=\"doConnect()\">{{ linked ? \"刷新\" : \"立即连接\" }}</xw-button>\r\n      <xw-button v-if=\"linked\" @click=\"doDisconnect()\">断开</xw-button>\r\n      <span v-if=\"!linked\" class=\"tips\"\r\n        >可将midi键盘或者电钢琴通过USB连接到您的电脑或手机后点击左侧连接按钮</span\r\n      >\r\n      <span v-if=\"errMsg\" class=\"tips error\">{{ errMsg }}</span>\r\n      <div v-if=\"deviceInfo.length >= 0\" class=\"d-info\">\r\n        <div v-for=\"item in deviceInfo\" :key=\"item.id\" class=\"d-info-item\">\r\n          已连接： {{ item.manufacturer }} {{ item.name }}\r\n        </div>\r\n      </div>\r\n      <div v-if=\"deviceInfo.length == 0 && linked\" class=\"d-info\">未检测到设备</div>\r\n    </div>\r\n    <div v-else class=\"not-support\">\r\n      检测到您的浏览器不支持该功能。此功能可在电脑上的Chorme浏览器，大于5.0版本的安卓手机上运行。苹果移动设备上兼容性未知。\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  isSupport, connect, disConnect, getMidiParse,\r\n} from '../controllers/midi-peripheral';\r\nimport xwButton from '../../../../../comp/xw-comp/xw-button.vue';\r\n\r\nexport default {\r\n  components: {\r\n    xwButton,\r\n  },\r\n  data() {\r\n    return {\r\n      support: false,\r\n      linked: false,\r\n      deviceInfo: [],\r\n      errMsg: '',\r\n    };\r\n  },\r\n  mounted() {\r\n    this.support = isSupport();\r\n    this.refreshInfo();\r\n  },\r\n  methods: {\r\n    doConnect() {\r\n      connect()\r\n        .then(() => {\r\n          this.refreshInfo();\r\n        })\r\n        .catch((e) => {\r\n          this.errMsg = `${e}`;\r\n        });\r\n    },\r\n    doDisconnect() {\r\n      disConnect();\r\n      this.refreshInfo();\r\n    },\r\n    refreshInfo() {\r\n      const midiParser = getMidiParse();\r\n      if (midiParser) {\r\n        this.linked = true;\r\n        const deviceInfo = [];\r\n        midiParser.inputs.forEach((item) => {\r\n          deviceInfo.push({\r\n            id: item.id,\r\n            name: item.name,\r\n            manufacturer: item.manufacturer,\r\n          });\r\n        });\r\n        this.deviceInfo = deviceInfo;\r\n      } else {\r\n        this.linked = false;\r\n        this.deviceInfo = [];\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"stylus\">\r\n.midi-access {\r\n    vertical-align top;\r\n    display inline-block;\r\n    >.support {\r\n        >.tips {\r\n            margin 0 10px;\r\n            font-size 13px;\r\n            &.error {\r\n                color #f00;\r\n            }\r\n        }\r\n        >.d-info {\r\n            padding 5px 0;\r\n            font-size 12px;\r\n        }\r\n    }\r\n    >.not-support {\r\n        font-size 13px;\r\n    }\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../../node_modules/babel-loader/lib/index.js!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./settings-midi-peripheral.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../../node_modules/babel-loader/lib/index.js!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./settings-midi-peripheral.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./settings-midi-peripheral.vue?vue&type=template&id=1e8a7bfe\"\nimport script from \"./settings-midi-peripheral.vue?vue&type=script&lang=js\"\nexport * from \"./settings-midi-peripheral.vue?vue&type=script&lang=js\"\nimport style0 from \"./settings-midi-peripheral.vue?vue&type=style&index=0&id=1e8a7bfe&prod&lang=stylus\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template>\r\n  <div class=\"piano-sts\">\r\n    <div class=\"form-ct\">\r\n      <div class=\"form\">\r\n        <div class=\"sts-row\">\r\n          <label>隐藏顶部导航栏：</label>\r\n          <xwSwitch v-model=\"state.hideNavBar\" />\r\n        </div>\r\n        <div class=\"sts-row\">\r\n          <label>显示键盘上数字：</label>\r\n          <xwSwitch v-model=\"state.cacheConf.showKbdNum\" />\r\n        </div>\r\n        <div class=\"sts-row\">\r\n          <label>放大和缩小键盘：</label>\r\n          <xw-button type=\"primary\" @click=\"scaleCG(-1)\">缩小</xw-button>\r\n          <b class=\"scaletext\">{{ state.cacheConf.scale }}</b>\r\n          <xw-button type=\"primary\" @click=\"scaleCG(1)\">放大</xw-button>\r\n        </div>\r\n        <div class=\"sts-row\">\r\n          <label>外接MIDI键盘：</label>\r\n          <settings-midi-peripheral />\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div v-show=\"state.cacheConf.barScale < 1\" class=\"btm-fixed\">\r\n      <div class=\"visible-line\">\r\n        <div\r\n          class=\"visible-bar\"\r\n          :style=\"{\r\n            width: `${state.cacheConf.barScale * 100}%`,\r\n            left: `${(1 - state.cacheConf.barScale) * state.cacheConf.left * 100}%`\r\n          }\"\r\n        />\r\n      </div>\r\n      <div class=\"xw-btn f-btn lef\" @click=\"mleft(false)\">左</div>\r\n      <div class=\"xw-btn f-btn rit\" @click=\"mleft(true)\">右</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport xwSwitch from '../comp/xw-switch.vue';\r\nimport { resize } from '../size';\r\nimport xwButton from '../../../../../comp/xw-comp/xw-button.vue';\r\nimport settingsMidiPeripheral from './settings-midi-peripheral.vue';\r\n\r\nexport default {\r\n  components: {\r\n    xwSwitch,\r\n    xwButton,\r\n    settingsMidiPeripheral,\r\n  },\r\n  data() {\r\n    return {};\r\n  },\r\n  computed: {\r\n    state() {\r\n      return this.$store.state;\r\n    },\r\n  },\r\n  watch: {\r\n    'state.hideNavBar': function _() {\r\n      this.$nextTick(resize);\r\n    },\r\n    'state.cacheConf.showKbdNum': function _() {\r\n      //\r\n    },\r\n  },\r\n  mounted() {},\r\n  methods: {\r\n    scaleCG(v) {\r\n      let s = this.state.cacheConf.scale;\r\n      s += v;\r\n      if (s < 1) {\r\n        s = 1;\r\n      } else if (s > 20) {\r\n        s = 20;\r\n      }\r\n      this.state.cacheConf.scale = s;\r\n      this.$nextTick(resize);\r\n    },\r\n    mleft(v) {\r\n      let f = this.state.cacheConf.left;\r\n      if (v) {\r\n        f += 0.1;\r\n      } else {\r\n        f -= 0.1;\r\n      }\r\n      if (f < 0) {\r\n        f = 0;\r\n      } else if (f > 1) {\r\n        f = 1;\r\n      }\r\n      this.state.cacheConf.left = f;\r\n      resize();\r\n    },\r\n  },\r\n};\r\n/**\r\n * 调大调小键盘的按钮\r\n * 左右移动键盘可见区的按钮\r\n * 显示或隐藏键盘上字母和数字的按钮\r\n */\r\n</script>\r\n\r\n<style lang=\"stylus\">\r\n@import '../comp/btn.styl';\r\n.piano-sts{\r\n    height 100%;\r\n    font-size 15px;\r\n    >.form-ct {\r\n        position absolute;\r\n        top 0;\r\n        left 0;\r\n        width 100%;\r\n        bottom 32px;\r\n        overflow-y auto;\r\n        >div.form {\r\n            padding 20px;\r\n            >.sts-row {\r\n                padding 0 0 8px;\r\n                >label {\r\n                    margin 0 0px 0 0;\r\n                    user-select none;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    .scaletext {\r\n        display inline-block;\r\n        padding 0 10px;\r\n    }\r\n    >.btm-fixed {\r\n        position absolute;\r\n        bottom 0px;\r\n        left 0;\r\n        height 32px;\r\n        width 100%;\r\n        // padding 16px 0 0 0;\r\n        >.visible-line {\r\n            position relative;\r\n            top 16px;\r\n            height 1px;\r\n            background-color #0006;\r\n            margin 0 36px;\r\n            pointer-events none;\r\n            >.visible-bar {\r\n                position relative;\r\n                width 0;\r\n                top -2px;\r\n                height 5px;\r\n                background-color #2579c294;\r\n                // border 1px solid #fff;\r\n                // box-shadow 0 0 5px #0003;\r\n            }\r\n        }\r\n        >.f-btn {\r\n            position absolute;\r\n            top 2px;\r\n            margin 0 2px;\r\n            width 28px;\r\n            height 24px;\r\n            line-height 25px;\r\n            text-align center;\r\n            font-size 12px;\r\n            padding 0;\r\n            &.rit {\r\n                right 0;\r\n            }\r\n        }\r\n    }\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../../node_modules/babel-loader/lib/index.js!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./settings.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../../node_modules/babel-loader/lib/index.js!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./settings.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./settings.vue?vue&type=template&id=452e429e\"\nimport script from \"./settings.vue?vue&type=script&lang=js\"\nexport * from \"./settings.vue?vue&type=script&lang=js\"\nimport style0 from \"./settings.vue?vue&type=style&index=0&id=452e429e&prod&lang=stylus\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--12-oneOf-1-0!../../../../../../node_modules/css-loader/dist/cjs.js??ref--12-oneOf-1-1!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/src/index.js??ref--12-oneOf-1-2!../../../../../../node_modules/stylus-loader/index.js??ref--12-oneOf-1-3!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./settings.vue?vue&type=style&index=0&id=452e429e&prod&lang=stylus\"","export * from \"-!../../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--12-oneOf-1-0!../../../../../../node_modules/css-loader/dist/cjs.js??ref--12-oneOf-1-1!../../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../node_modules/postcss-loader/src/index.js??ref--12-oneOf-1-2!../../../../../../node_modules/stylus-loader/index.js??ref--12-oneOf-1-3!../../../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./settings-midi-peripheral.vue?vue&type=style&index=0&id=1e8a7bfe&prod&lang=stylus\""],"sourceRoot":""}